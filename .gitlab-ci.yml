# Minecraft Docker Compiler
# GitLab CI/CD configuration

variables:
  # The version of Minecraft to build, by default, all of them
  MINECRAFT_VERSION: "all"

stages:
  - build

before_script:
  - apt update
  - apt install python3 python3-pip python3-venv

# Vanilla
vanilla-build:
  stage: build
  services:
    - docker:dind
  script:
    - echo "Building Vanilla Minecraft Docker images..."
    - bash run.sh --minecraft "$MINECRAFT_VERSION"
  # Run this job only when there are changes to the main branch and they target source code
  only:
    refs:
      - main
    changes:
      - minecraft/vanilla/*
      - src/*
      - config.yml

# Forge
forge-build:
  stage: build
  script:
    - echo "Building Forge Minecraft Docker images..."
    - bash run.sh -t forge --minecraft "$MINECRAFT_VERSION"
  # Run this job only when there are changes to the main branch and they target source code
  only:
    refs:
      - main
    changes:
      - minecraft/forge/*
      - src/*
      - config.yml

# Bedrock - disabled until this is fixed: https://gitlab.com/rdall96/minecraft-docker/-/issues/7
# bedrock-build:
#   stage: build
#   script:
#     - echo "Building Bedrock Minecraft Docker images..."
#     - bash run.sh -t bedrock --minecraft 1.19.2
#   # Run this job only when there are changes to the main branch and they target source code
#   only:
#     refs:
#       - main
#     changes:
#       - minecraft/bedrock/*
#       - src/*
#       - config.yml

# Fabric
fabric-build:
  stage: build
  script:
    - echo "Building Fabric Minecraft Docker images..."
    - bash run.sh -t fabric --minecraft "$MINECRAFT_VERSION"
  # Run this job only when there are changes to the main branch and they target source code
  only:
    refs:
      - main
    changes:
      - minecraft/fabric/*
      - src/*
      - config.yml
